# AI Assistant æ’ä»¶æ‰©å±•åˆ†ææ–‡æ¡£

## ä¸€ã€éœ€æ±‚æ¦‚è¿°

å½“å‰æ’ä»¶ä»…æ”¯æŒç®€å•çš„ã€Œå•å­—æ®µè§¦å‘ â†’ å•å­—æ®µè¾“å‡ºã€æ¨¡å¼ï¼Œéœ€è¦æ‰©å±•ä¸ºæ›´çµæ´»ã€æ›´ç¬¦åˆå®é™…ä½¿ç”¨åœºæ™¯çš„é…ç½®æ–¹å¼ã€‚

---

## äºŒã€æ ¸å¿ƒåŠŸèƒ½æ‰©å±•

### 2.1 å¤šå­—æ®µè§¦å‘æœºåˆ¶

#### åœºæ™¯åˆ†æ
| åœºæ™¯ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| å•å­—æ®µè§¦å‘ | ä¿®æ”¹æŸä¸ªå­—æ®µæ—¶è§¦å‘ AI | ä¿®æ”¹ã€Œé—®é¢˜ã€å­—æ®µï¼Œç”Ÿæˆã€Œç­”æ¡ˆã€ |
| å¤šå­—æ®µè”åˆè§¦å‘ | å¤šä¸ªå­—æ®µéƒ½æœ‰å€¼æ—¶æ‰è§¦å‘ | ã€Œå§“åã€+ã€ŒèŒä½ã€éƒ½å¡«å†™åï¼Œç”Ÿæˆã€Œç®€ä»‹ã€ |
| ä»»ä¸€å­—æ®µè§¦å‘ | ä»»æ„ä¸€ä¸ªå­—æ®µå˜åŒ–å°±è§¦å‘ | ã€Œæ ‡é¢˜ã€æˆ–ã€Œæè¿°ã€å˜åŒ–ï¼Œæ›´æ–°ã€Œæ‘˜è¦ã€ |

#### æ•°æ®æ¨¡å‹è®¾è®¡
```python
class AIFieldConfig(models.Model):
    # è§¦å‘å­—æ®µï¼ˆæ”¯æŒå¤šé€‰ï¼‰
    trigger_fields = models.JSONField(
        default=list,
        help_text="è§¦å‘ AI çš„å­—æ®µ ID åˆ—è¡¨"
    )
    
    # è§¦å‘æ¨¡å¼
    TRIGGER_MODE_CHOICES = [
        ('any', 'ä»»ä¸€å­—æ®µå˜åŒ–'),      # OR é€»è¾‘
        ('all', 'æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼'),    # AND é€»è¾‘
        ('specific', 'æŒ‡å®šå­—æ®µå˜åŒ–'), # ç‰¹å®šå­—æ®µ
    ]
    trigger_mode = models.CharField(
        max_length=20,
        choices=TRIGGER_MODE_CHOICES,
        default='any'
    )
```

### 2.2 æç¤ºè¯æ¨¡æ¿å¢å¼º

#### å¤šå­—æ®µå¼•ç”¨è¯­æ³•
```
å½“å‰è¯­æ³•ï¼š{input}ï¼ˆä»…æ”¯æŒå•å­—æ®µï¼‰

æ‰©å±•è¯­æ³•ï¼š
- {field_name}     - æŒ‰å­—æ®µåå¼•ç”¨
- {field_123}      - æŒ‰å­—æ®µ ID å¼•ç”¨
- {all_fields}     - æ‰€æœ‰è§¦å‘å­—æ®µçš„å€¼ï¼ˆJSON æ ¼å¼ï¼‰
- {field_name|default:æ— } - å¸¦é»˜è®¤å€¼
```

#### ç¤ºä¾‹
```
è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆäº§å“æè¿°ï¼š
- äº§å“åç§°ï¼š{äº§å“åç§°}
- äº§å“ç±»åˆ«ï¼š{ç±»åˆ«}
- æ ¸å¿ƒå–ç‚¹ï¼š{å–ç‚¹|default:æš‚æ— }
- ä»·æ ¼åŒºé—´ï¼š{ä»·æ ¼}

è¦æ±‚ï¼šç”Ÿæˆ 100 å­—ä»¥å†…çš„è¥é”€æ–‡æ¡ˆã€‚
```


### 2.3 è§¦å‘æ¡ä»¶æ§åˆ¶

#### æ¡ä»¶ç±»å‹
| æ¡ä»¶ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| ç›®æ ‡å­—æ®µä¸ºç©ºæ—¶è§¦å‘ | åªæœ‰è¾“å‡ºå­—æ®µæ²¡æœ‰å€¼æ‰æ‰§è¡Œ AI | é¿å…è¦†ç›–å·²æœ‰å†…å®¹ |
| ç›®æ ‡å­—æ®µæœ‰å€¼æ—¶è·³è¿‡ | åŒä¸Šï¼Œæ›´ç›´è§‚çš„è¡¨è¿° | ä¿æŠ¤æ‰‹åŠ¨ç¼–è¾‘çš„å†…å®¹ |
| æŒ‡å®šå­—æ®µä¸ºç©ºæ—¶è§¦å‘ | æŸä¸ªæ¡ä»¶å­—æ®µä¸ºç©ºæ‰è§¦å‘ | æ¡ä»¶æ€§ç”Ÿæˆ |
| æŒ‡å®šå­—æ®µæœ‰å€¼æ—¶è§¦å‘ | æŸä¸ªæ¡ä»¶å­—æ®µæœ‰å€¼æ‰è§¦å‘ | ä¾èµ–æ€§ç”Ÿæˆ |
| å¼ºåˆ¶è¦†ç›– | æ— è®ºç›®æ ‡æ˜¯å¦æœ‰å€¼éƒ½æ‰§è¡Œ | å®æ—¶æ›´æ–°åœºæ™¯ |

#### æ•°æ®æ¨¡å‹è®¾è®¡
```python
class AIFieldConfig(models.Model):
    # æ‰§è¡Œæ¡ä»¶
    EXECUTION_CONDITION_CHOICES = [
        ('always', 'å§‹ç»ˆæ‰§è¡Œ'),
        ('target_empty', 'ç›®æ ‡å­—æ®µä¸ºç©ºæ—¶æ‰§è¡Œ'),
        ('target_not_empty', 'ç›®æ ‡å­—æ®µæœ‰å€¼æ—¶æ‰§è¡Œ'),
        ('condition_field_empty', 'æ¡ä»¶å­—æ®µä¸ºç©ºæ—¶æ‰§è¡Œ'),
        ('condition_field_not_empty', 'æ¡ä»¶å­—æ®µæœ‰å€¼æ—¶æ‰§è¡Œ'),
    ]
    execution_condition = models.CharField(
        max_length=30,
        choices=EXECUTION_CONDITION_CHOICES,
        default='target_empty'
    )
    
    # æ¡ä»¶å­—æ®µï¼ˆå½“ execution_condition ä¸º condition_* æ—¶ä½¿ç”¨ï¼‰
    condition_field = models.ForeignKey(
        Field,
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        related_name="ai_condition_configs"
    )
    
    # æ˜¯å¦å…è®¸è¦†ç›–å·²æœ‰å€¼
    allow_overwrite = models.BooleanField(
        default=False,
        help_text="ç›®æ ‡å­—æ®µæœ‰å€¼æ—¶æ˜¯å¦è¦†ç›–"
    )
```

---

## ä¸‰ã€è¾“å‡ºæ§åˆ¶æ‰©å±•

### 3.1 å¤šç›®æ ‡å­—æ®µè¾“å‡º

#### åœºæ™¯
ä¸€æ¬¡ AI è°ƒç”¨ç”Ÿæˆå¤šä¸ªå­—æ®µçš„å†…å®¹ï¼Œä¾‹å¦‚ï¼š
- è¾“å…¥ï¼šäº§å“ä¿¡æ¯
- è¾“å‡ºï¼šæ ‡é¢˜ã€æè¿°ã€å…³é”®è¯ã€åˆ†ç±»ï¼ˆå¤šä¸ªå­—æ®µï¼‰

#### æ•°æ®æ¨¡å‹
```python
class AIFieldConfig(models.Model):
    # è¾“å‡ºå­—æ®µï¼ˆæ”¯æŒå¤šé€‰ï¼‰
    output_fields = models.JSONField(
        default=list,
        help_text="AI ç»“æœå†™å…¥çš„å­—æ®µ ID åˆ—è¡¨"
    )
    
    # è¾“å‡ºæ¨¡å¼
    OUTPUT_MODE_CHOICES = [
        ('single', 'å•å­—æ®µè¾“å‡º'),
        ('json_parse', 'JSON è§£æåˆ°å¤šå­—æ®µ'),
        ('same_value', 'ç›¸åŒå€¼å†™å…¥å¤šå­—æ®µ'),
    ]
    output_mode = models.CharField(
        max_length=20,
        choices=OUTPUT_MODE_CHOICES,
        default='single'
    )
    
    # JSON å­—æ®µæ˜ å°„ï¼ˆoutput_mode ä¸º json_parse æ—¶ä½¿ç”¨ï¼‰
    # æ ¼å¼ï¼š{"json_key": field_id, "title": 123, "description": 456}
    output_field_mapping = models.JSONField(
        default=dict,
        blank=True
    )
```

#### JSON è§£æç¤ºä¾‹
æç¤ºè¯è¦æ±‚ AI è¿”å› JSONï¼š
```
è¯·åˆ†æä»¥ä¸‹äº§å“ï¼Œè¿”å› JSON æ ¼å¼ï¼š
{"title": "...", "description": "...", "keywords": "..."}
```

æ˜ å°„é…ç½®ï¼š
```json
{
  "title": 123,        // å†™å…¥å­—æ®µ ID 123
  "description": 456,  // å†™å…¥å­—æ®µ ID 456
  "keywords": 789      // å†™å…¥å­—æ®µ ID 789
}
```


### 3.2 è¾“å‡ºåå¤„ç†

#### å¤„ç†é€‰é¡¹
| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| åŸæ ·è¾“å‡º | AI è¿”å›ä»€ä¹ˆå°±å†™ä»€ä¹ˆ |
| å»é™¤é¦–å°¾ç©ºç™½ | trim å¤„ç† |
| æå– JSON | ä»å“åº”ä¸­æå– JSON éƒ¨åˆ† |
| æ­£åˆ™æå– | ç”¨æ­£åˆ™è¡¨è¾¾å¼æå–ç‰¹å®šå†…å®¹ |
| é•¿åº¦é™åˆ¶ | æˆªæ–­è¶…é•¿å†…å®¹ |

---

## å››ã€é«˜çº§è§¦å‘æ§åˆ¶

### 4.1 é˜²é‡å¤è§¦å‘

#### é—®é¢˜
- AI å†™å…¥ç›®æ ‡å­—æ®µåï¼Œå¯èƒ½è§¦å‘å…¶ä»–é…ç½®
- ç”¨æˆ·å¿«é€Ÿè¿ç»­ç¼–è¾‘ï¼Œè§¦å‘å¤šæ¬¡ AI è°ƒç”¨

#### è§£å†³æ–¹æ¡ˆ
```python
class AIFieldConfig(models.Model):
    # é˜²æŠ–æ—¶é—´ï¼ˆç§’ï¼‰
    debounce_seconds = models.IntegerField(
        default=2,
        help_text="è¿ç»­ç¼–è¾‘æ—¶çš„ç­‰å¾…æ—¶é—´"
    )
    
    # å¿½ç•¥ AI å†™å…¥çš„è§¦å‘
    ignore_ai_updates = models.BooleanField(
        default=True,
        help_text="AI æ›´æ–°å­—æ®µæ—¶ä¸è§¦å‘å…¶ä»–é…ç½®"
    )
```

### 4.2 æ‰‹åŠ¨è§¦å‘æ¨¡å¼

#### åœºæ™¯
ç”¨æˆ·ä¸å¸Œæœ›è‡ªåŠ¨è§¦å‘ï¼Œè€Œæ˜¯æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®ç”Ÿæˆ

```python
class AIFieldConfig(models.Model):
    TRIGGER_TYPE_CHOICES = [
        ('auto', 'è‡ªåŠ¨è§¦å‘'),
        ('manual', 'æ‰‹åŠ¨è§¦å‘'),
        ('both', 'è‡ªåŠ¨+æ‰‹åŠ¨'),
    ]
    trigger_type = models.CharField(
        max_length=10,
        choices=TRIGGER_TYPE_CHOICES,
        default='auto'
    )
```

---

## äº”ã€UI/UX è®¾è®¡è§„èŒƒ

### 5.1 é…ç½®è¡¨å•å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI åŠ©æ‰‹é…ç½®                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€ åŸºæœ¬è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  é…ç½®åç§°ï¼š[________________]                       â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  å¯ç”¨çŠ¶æ€ï¼š[âœ“] å¯ç”¨æ­¤é…ç½®                           â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€ è§¦å‘è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  è§¦å‘æ–¹å¼ï¼š(â€¢) è‡ªåŠ¨è§¦å‘  ( ) æ‰‹åŠ¨è§¦å‘  ( ) ä¸¤è€…     â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  è§¦å‘å­—æ®µï¼š                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ [Ã—] äº§å“åç§°  [Ã—] äº§å“æè¿°  [+] æ·»åŠ å­—æ®µ     â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  è§¦å‘æ¨¡å¼ï¼š                                         â”‚ â”‚
â”‚  â”‚  (â€¢) ä»»ä¸€å­—æ®µå˜åŒ–æ—¶è§¦å‘                             â”‚ â”‚
â”‚  â”‚  ( ) æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼æ—¶è§¦å‘                           â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€ æ‰§è¡Œæ¡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  æ‰§è¡Œæ¡ä»¶ï¼š[ç›®æ ‡å­—æ®µä¸ºç©ºæ—¶æ‰§è¡Œ â–¼]                   â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â”‚  [_] å…è®¸è¦†ç›–å·²æœ‰å†…å®¹                               â”‚ â”‚
â”‚  â”‚                                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 5.2 æç¤ºè¯ç¼–è¾‘å™¨å¸ƒå±€

```
â”Œâ”€ æç¤ºè¯è®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚  å¯ç”¨å­—æ®µå˜é‡ï¼š                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ {äº§å“åç§°}  {äº§å“æè¿°}  {ä»·æ ¼}  {åˆ†ç±»}  [å¤åˆ¶]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  æç¤ºè¯æ¨¡æ¿ï¼š                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ è¯·æ ¹æ®ä»¥ä¸‹äº§å“ä¿¡æ¯ç”Ÿæˆè¥é”€æ–‡æ¡ˆï¼š                    â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚ äº§å“åç§°ï¼š{äº§å“åç§°}                                â”‚  â”‚
â”‚  â”‚ äº§å“æè¿°ï¼š{äº§å“æè¿°}                                â”‚  â”‚
â”‚  â”‚ ä»·æ ¼ï¼š{ä»·æ ¼}                                        â”‚  â”‚
â”‚  â”‚                                                     â”‚  â”‚
â”‚  â”‚ è¦æ±‚ï¼š                                              â”‚  â”‚
â”‚  â”‚ 1. çªå‡ºäº§å“å–ç‚¹                                     â”‚  â”‚
â”‚  â”‚ 2. æ§åˆ¶åœ¨ 100 å­—ä»¥å†…                                â”‚  â”‚
â”‚  â”‚ 3. è¯­æ°”äº²åˆ‡æœ‰æ„ŸæŸ“åŠ›                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  ğŸ’¡ æç¤ºï¼šç‚¹å‡»ä¸Šæ–¹å­—æ®µæ ‡ç­¾å¯å¿«é€Ÿæ’å…¥å˜é‡                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 è¾“å‡ºè®¾ç½®å¸ƒå±€

```
â”Œâ”€ è¾“å‡ºè®¾ç½® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  è¾“å‡ºæ¨¡å¼ï¼š                                              â”‚
â”‚  (â€¢) å•å­—æ®µè¾“å‡º                                          â”‚
â”‚  ( ) JSON è§£æåˆ°å¤šå­—æ®µ                                   â”‚
â”‚  ( ) ç›¸åŒå€¼å†™å…¥å¤šå­—æ®µ                                    â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                         â”‚
â”‚  ã€å•å­—æ®µè¾“å‡ºæ¨¡å¼ã€‘                                      â”‚
â”‚  è¾“å‡ºå­—æ®µï¼š[AI ç”Ÿæˆæ–‡æ¡ˆ â–¼]                               â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                         â”‚
â”‚  ã€JSON è§£ææ¨¡å¼ã€‘                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  JSON é”®        â†’    ç›®æ ‡å­—æ®µ                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  title          â†’    [æ ‡é¢˜å­—æ®µ â–¼]               â”‚   â”‚
â”‚  â”‚  description    â†’    [æè¿°å­—æ®µ â–¼]               â”‚   â”‚
â”‚  â”‚  keywords       â†’    [å…³é”®è¯å­—æ®µ â–¼]             â”‚   â”‚
â”‚  â”‚  [+ æ·»åŠ æ˜ å°„]                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…­ã€å®Œæ•´æ•°æ®æ¨¡å‹

```python
class AIFieldConfig(models.Model):
    """AI å­—æ®µé…ç½® - æ‰©å±•ç‰ˆ"""
    
    table = models.ForeignKey(Table, on_delete=models.CASCADE)
    
    # === åŸºæœ¬ä¿¡æ¯ ===
    name = models.CharField(max_length=100, blank=True, help_text="é…ç½®åç§°")
    enabled = models.BooleanField(default=True)
    
    # === è§¦å‘è®¾ç½® ===
    trigger_fields = models.JSONField(default=list, help_text="è§¦å‘å­—æ®µ ID åˆ—è¡¨")
    
    TRIGGER_MODE_CHOICES = [
        ('any', 'ä»»ä¸€å­—æ®µå˜åŒ–'),
        ('all', 'æ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼'),
    ]
    trigger_mode = models.CharField(max_length=20, choices=TRIGGER_MODE_CHOICES, default='any')
    
    TRIGGER_TYPE_CHOICES = [
        ('auto', 'è‡ªåŠ¨è§¦å‘'),
        ('manual', 'æ‰‹åŠ¨è§¦å‘'),
        ('both', 'è‡ªåŠ¨+æ‰‹åŠ¨'),
    ]
    trigger_type = models.CharField(max_length=10, choices=TRIGGER_TYPE_CHOICES, default='auto')
    
    # === æ‰§è¡Œæ¡ä»¶ ===
    EXECUTION_CONDITION_CHOICES = [
        ('always', 'å§‹ç»ˆæ‰§è¡Œ'),
        ('target_empty', 'ç›®æ ‡å­—æ®µä¸ºç©ºæ—¶'),
        ('target_not_empty', 'ç›®æ ‡å­—æ®µæœ‰å€¼æ—¶'),
    ]
    execution_condition = models.CharField(max_length=30, choices=EXECUTION_CONDITION_CHOICES, default='target_empty')
    allow_overwrite = models.BooleanField(default=False)
    
    # === æç¤ºè¯ ===
    prompt_template = models.TextField(default="")
    
    # === AI æ¨¡å‹é…ç½® ===
    use_workspace_ai = models.BooleanField(default=True)
    ai_provider_type = models.CharField(max_length=50, blank=True)
    ai_model = models.CharField(max_length=100, blank=True)
    ai_temperature = models.FloatField(null=True, blank=True)
    
    # è‡ªå®šä¹‰é…ç½®ï¼ˆå‘åå…¼å®¹ï¼‰
    custom_model_name = models.CharField(max_length=100, blank=True)
    custom_api_url = models.URLField(blank=True)
    custom_api_key = models.CharField(max_length=500, blank=True)
    
    # === è¾“å‡ºè®¾ç½® ===
    OUTPUT_MODE_CHOICES = [
        ('single', 'å•å­—æ®µè¾“å‡º'),
        ('json_parse', 'JSON è§£æ'),
        ('multi_same', 'å¤šå­—æ®µç›¸åŒå€¼'),
    ]
    output_mode = models.CharField(max_length=20, choices=OUTPUT_MODE_CHOICES, default='single')
    output_fields = models.JSONField(default=list, help_text="è¾“å‡ºå­—æ®µ ID åˆ—è¡¨")
    output_field_mapping = models.JSONField(default=dict, help_text="JSON é”®åˆ°å­—æ®µçš„æ˜ å°„")
    
    # === é«˜çº§è®¾ç½® ===
    debounce_seconds = models.IntegerField(default=2)
    ignore_ai_updates = models.BooleanField(default=True)
    max_output_length = models.IntegerField(null=True, blank=True)
    
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```


---

## ä¸ƒã€ç”¨æˆ·åœºæ™¯ç”¨ä¾‹

### åœºæ™¯ 1ï¼šäº§å“æ–‡æ¡ˆç”Ÿæˆ
```yaml
è§¦å‘å­—æ®µ: [äº§å“åç§°, äº§å“æè¿°, ä»·æ ¼]
è§¦å‘æ¨¡å¼: allï¼ˆæ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼ï¼‰
æ‰§è¡Œæ¡ä»¶: target_emptyï¼ˆæ–‡æ¡ˆå­—æ®µä¸ºç©ºæ—¶ï¼‰
è¾“å‡ºæ¨¡å¼: single
è¾“å‡ºå­—æ®µ: AIæ–‡æ¡ˆ

æç¤ºè¯: |
  æ ¹æ®ä»¥ä¸‹äº§å“ä¿¡æ¯ç”Ÿæˆè¥é”€æ–‡æ¡ˆï¼š
  åç§°ï¼š{äº§å“åç§°}
  æè¿°ï¼š{äº§å“æè¿°}
  ä»·æ ¼ï¼š{ä»·æ ¼}
  è¦æ±‚ï¼š100å­—ä»¥å†…ï¼Œçªå‡ºå–ç‚¹
```

### åœºæ™¯ 2ï¼šå¤šè¯­è¨€ç¿»è¯‘
```yaml
è§¦å‘å­—æ®µ: [ä¸­æ–‡å†…å®¹]
è§¦å‘æ¨¡å¼: any
æ‰§è¡Œæ¡ä»¶: always
è¾“å‡ºæ¨¡å¼: json_parse
è¾“å‡ºå­—æ®µæ˜ å°„:
  en: è‹±æ–‡ç¿»è¯‘å­—æ®µID
  ja: æ—¥æ–‡ç¿»è¯‘å­—æ®µID
  ko: éŸ©æ–‡ç¿»è¯‘å­—æ®µID

æç¤ºè¯: |
  å°†ä»¥ä¸‹ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ï¼Œè¿”å› JSONï¼š
  {ä¸­æ–‡å†…å®¹}
  
  è¿”å›æ ¼å¼ï¼š{"en": "...", "ja": "...", "ko": "..."}
```

### åœºæ™¯ 3ï¼šæ™ºèƒ½åˆ†ç±»
```yaml
è§¦å‘å­—æ®µ: [æ–‡ç« æ ‡é¢˜, æ–‡ç« å†…å®¹]
è§¦å‘æ¨¡å¼: any
æ‰§è¡Œæ¡ä»¶: target_empty
è¾“å‡ºæ¨¡å¼: single
è¾“å‡ºå­—æ®µ: åˆ†ç±»

æç¤ºè¯: |
  æ ¹æ®ä»¥ä¸‹æ–‡ç« å†…å®¹ï¼Œé€‰æ‹©æœ€åˆé€‚çš„åˆ†ç±»ï¼š
  æ ‡é¢˜ï¼š{æ–‡ç« æ ‡é¢˜}
  å†…å®¹ï¼š{æ–‡ç« å†…å®¹}
  
  å¯é€‰åˆ†ç±»ï¼šæŠ€æœ¯ã€äº§å“ã€è¿è¥ã€è®¾è®¡ã€å…¶ä»–
  åªè¿”å›åˆ†ç±»åç§°ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
```

### åœºæ™¯ 4ï¼šæ•°æ®è¡¥å…¨
```yaml
è§¦å‘å­—æ®µ: [å…¬å¸åç§°]
è§¦å‘æ¨¡å¼: any
æ‰§è¡Œæ¡ä»¶: target_empty
è¾“å‡ºæ¨¡å¼: json_parse
è¾“å‡ºå­—æ®µæ˜ å°„:
  industry: è¡Œä¸šå­—æ®µID
  size: è§„æ¨¡å­—æ®µID
  description: ç®€ä»‹å­—æ®µID

æç¤ºè¯: |
  æ ¹æ®å…¬å¸åç§°ï¼Œè¡¥å…¨ä»¥ä¸‹ä¿¡æ¯ï¼š
  å…¬å¸ï¼š{å…¬å¸åç§°}
  
  è¿”å› JSONï¼š{"industry": "è¡Œä¸š", "size": "è§„æ¨¡", "description": "ç®€ä»‹"}
```

---

## å…«ã€æ ·å¼è§„èŒƒ

### 8.1 é¢œè‰²ç³»ç»Ÿ
```css
/* ä¸»è‰²è°ƒ */
--ai-primary: #5190ef;        /* ä¸»æŒ‰é’®ã€å¼ºè°ƒ */
--ai-primary-hover: #3a7bd5;  /* æ‚¬åœçŠ¶æ€ */

/* çŠ¶æ€è‰² */
--ai-success: #10b981;        /* æˆåŠŸã€å¯ç”¨ */
--ai-warning: #f59e0b;        /* è­¦å‘Šã€å¤„ç†ä¸­ */
--ai-error: #ef4444;          /* é”™è¯¯ã€ç¦ç”¨ */

/* ä¸­æ€§è‰² */
--ai-bg: #f9fafb;             /* èƒŒæ™¯ */
--ai-border: #e5e7eb;         /* è¾¹æ¡† */
--ai-text: #374151;           /* ä¸»æ–‡å­— */
--ai-text-secondary: #6b7280; /* æ¬¡è¦æ–‡å­— */
```

### 8.2 é—´è·è§„èŒƒ
```css
/* åŒºå—é—´è· */
--spacing-section: 24px;      /* å¤§åŒºå—ä¹‹é—´ */
--spacing-group: 16px;        /* è¡¨å•ç»„ä¹‹é—´ */
--spacing-item: 12px;         /* è¡¨å•é¡¹ä¹‹é—´ */
--spacing-inner: 8px;         /* å†…éƒ¨å…ƒç´  */
```

### 8.3 ç»„ä»¶è§„èŒƒ

#### å¡ç‰‡å®¹å™¨
```css
.ai-config-card {
  background: white;
  border: 1px solid var(--ai-border);
  border-radius: 8px;
  padding: 20px;
  margin-bottom: var(--spacing-section);
}

.ai-config-card__title {
  font-size: 14px;
  font-weight: 600;
  color: var(--ai-text);
  margin-bottom: var(--spacing-group);
  padding-bottom: 12px;
  border-bottom: 1px solid var(--ai-border);
}
```

#### å­—æ®µæ ‡ç­¾ï¼ˆå¯ç‚¹å‡»æ’å…¥ï¼‰
```css
.ai-field-tag {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  background: #eef2ff;
  color: #4f46e5;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
  transition: all 0.2s;
}

.ai-field-tag:hover {
  background: #4f46e5;
  color: white;
}
```

#### å¤šé€‰å­—æ®µå®¹å™¨
```css
.ai-field-selector {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 12px;
  background: var(--ai-bg);
  border: 1px dashed var(--ai-border);
  border-radius: 6px;
  min-height: 44px;
}

.ai-field-selector__item {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px 4px 12px;
  background: white;
  border: 1px solid var(--ai-border);
  border-radius: 4px;
  font-size: 13px;
}

.ai-field-selector__remove {
  cursor: pointer;
  color: var(--ai-text-secondary);
}

.ai-field-selector__remove:hover {
  color: var(--ai-error);
}
```


---

## ä¹ã€ä¿¡å·å¤„ç†é€»è¾‘

### 9.1 è§¦å‘åˆ¤æ–­æµç¨‹

```
è¡Œæ›´æ–°äº‹ä»¶
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è·å–è¯¥è¡¨æ‰€æœ‰å¯ç”¨çš„é…ç½®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éå†æ¯ä¸ªé…ç½®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ£€æŸ¥è§¦å‘ç±»å‹              â”‚
â”‚    - auto/both â†’ ç»§ç»­       â”‚
â”‚    - manual â†’ è·³è¿‡          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. æ£€æŸ¥æ›´æ–°å­—æ®µæ˜¯å¦åœ¨è§¦å‘åˆ—è¡¨ â”‚
â”‚    - ä¸åœ¨ â†’ è·³è¿‡            â”‚
â”‚    - åœ¨ â†’ ç»§ç»­              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ£€æŸ¥è§¦å‘æ¨¡å¼              â”‚
â”‚    - any: ä»»ä¸€å­—æ®µå˜åŒ–å³å¯   â”‚
â”‚    - all: æ‰€æœ‰è§¦å‘å­—æ®µæœ‰å€¼   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ£€æŸ¥æ‰§è¡Œæ¡ä»¶              â”‚
â”‚    - always: ç›´æ¥æ‰§è¡Œ       â”‚
â”‚    - target_empty: æ£€æŸ¥ç›®æ ‡ â”‚
â”‚    - å…¶ä»–æ¡ä»¶...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ£€æŸ¥æ˜¯å¦å…è®¸è¦†ç›–          â”‚
â”‚    - ç›®æ ‡æœ‰å€¼ä¸”ä¸å…è®¸ â†’ è·³è¿‡ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. æ£€æŸ¥é˜²æŠ–                  â”‚
â”‚    - çŸ­æ—¶é—´å†…é‡å¤ â†’ è·³è¿‡     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. æäº¤å¼‚æ­¥ä»»åŠ¡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 æç¤ºè¯è§£æé€»è¾‘

```python
def parse_prompt_template(template: str, row, fields: list) -> str:
    """
    è§£ææç¤ºè¯æ¨¡æ¿ï¼Œæ›¿æ¢å­—æ®µå˜é‡
    
    æ”¯æŒçš„è¯­æ³•ï¼š
    - {å­—æ®µå}           æŒ‰åç§°å¼•ç”¨
    - {field_123}        æŒ‰ ID å¼•ç”¨
    - {å­—æ®µå|default:å€¼} å¸¦é»˜è®¤å€¼
    """
    result = template
    
    # æ„å»ºå­—æ®µæ˜ å°„
    field_map = {}
    for field in fields:
        field_name = field.name
        field_id = field.id
        field_value = getattr(row, f"field_{field_id}", "") or ""
        
        field_map[field_name] = field_value
        field_map[f"field_{field_id}"] = field_value
    
    # æ›¿æ¢å¸¦é»˜è®¤å€¼çš„å˜é‡ {name|default:value}
    pattern = r'\{([^}|]+)\|default:([^}]*)\}'
    def replace_with_default(match):
        key = match.group(1)
        default = match.group(2)
        return field_map.get(key, default) or default
    
    result = re.sub(pattern, replace_with_default, result)
    
    # æ›¿æ¢æ™®é€šå˜é‡ {name}
    for key, value in field_map.items():
        result = result.replace(f"{{{key}}}", str(value))
    
    return result
```

---

## åã€è¿ç§»è®¡åˆ’

### 10.1 æ•°æ®åº“è¿ç§»æ­¥éª¤

```python
# migrations/0003_extend_ai_config.py

class Migration(migrations.Migration):
    dependencies = [
        ('ai_assistant', '0002_add_workspace_ai_fields'),
    ]
    
    operations = [
        # 1. æ·»åŠ é…ç½®åç§°
        migrations.AddField(
            model_name='aifieldconfig',
            name='name',
            field=models.CharField(max_length=100, blank=True),
        ),
        
        # 2. æ·»åŠ è§¦å‘å­—æ®µåˆ—è¡¨
        migrations.AddField(
            model_name='aifieldconfig',
            name='trigger_fields',
            field=models.JSONField(default=list),
        ),
        
        # 3. æ·»åŠ è§¦å‘æ¨¡å¼
        migrations.AddField(
            model_name='aifieldconfig',
            name='trigger_mode',
            field=models.CharField(max_length=20, default='any'),
        ),
        
        # 4. æ·»åŠ è§¦å‘ç±»å‹
        migrations.AddField(
            model_name='aifieldconfig',
            name='trigger_type',
            field=models.CharField(max_length=10, default='auto'),
        ),
        
        # 5. æ·»åŠ æ‰§è¡Œæ¡ä»¶
        migrations.AddField(
            model_name='aifieldconfig',
            name='execution_condition',
            field=models.CharField(max_length=30, default='target_empty'),
        ),
        
        # 6. æ·»åŠ å…è®¸è¦†ç›–
        migrations.AddField(
            model_name='aifieldconfig',
            name='allow_overwrite',
            field=models.BooleanField(default=False),
        ),
        
        # 7. æ·»åŠ è¾“å‡ºæ¨¡å¼
        migrations.AddField(
            model_name='aifieldconfig',
            name='output_mode',
            field=models.CharField(max_length=20, default='single'),
        ),
        
        # 8. æ·»åŠ è¾“å‡ºå­—æ®µåˆ—è¡¨
        migrations.AddField(
            model_name='aifieldconfig',
            name='output_fields',
            field=models.JSONField(default=list),
        ),
        
        # 9. æ·»åŠ è¾“å‡ºå­—æ®µæ˜ å°„
        migrations.AddField(
            model_name='aifieldconfig',
            name='output_field_mapping',
            field=models.JSONField(default=dict),
        ),
        
        # 10. æ·»åŠ é˜²æŠ–æ—¶é—´
        migrations.AddField(
            model_name='aifieldconfig',
            name='debounce_seconds',
            field=models.IntegerField(default=2),
        ),
    ]
```

### 10.2 æ•°æ®è¿ç§»ï¼ˆå…¼å®¹æ—§æ•°æ®ï¼‰

```python
def migrate_old_configs(apps, schema_editor):
    """å°†æ—§é…ç½®è¿ç§»åˆ°æ–°æ ¼å¼"""
    AIFieldConfig = apps.get_model('ai_assistant', 'AIFieldConfig')
    
    for config in AIFieldConfig.objects.all():
        # å°†å•ä¸ª source_field è¿ç§»åˆ° trigger_fields åˆ—è¡¨
        if config.source_field_id and not config.trigger_fields:
            config.trigger_fields = [config.source_field_id]
        
        # å°†å•ä¸ª target_field è¿ç§»åˆ° output_fields åˆ—è¡¨
        if config.target_field_id and not config.output_fields:
            config.output_fields = [config.target_field_id]
        
        config.save()
```

---

## åä¸€ã€å®ç°çŠ¶æ€

### âœ… å·²å®Œæˆ
1. âœ… å·¥ä½œåŒº AI é…ç½®é›†æˆ
2. âœ… å¤šè§¦å‘å­—æ®µæ”¯æŒ
3. âœ… æ‰§è¡Œæ¡ä»¶æ§åˆ¶ï¼ˆç›®æ ‡ä¸ºç©ºæ—¶æ‰§è¡Œï¼‰
4. âœ… æç¤ºè¯å¤šå­—æ®µå˜é‡ `{å­—æ®µå}`
5. âœ… è§¦å‘æ¨¡å¼ï¼ˆany/allï¼‰
6. âœ… å…è®¸è¦†ç›–å¼€å…³
7. âœ… é…ç½®åç§°
8. âœ… UI æ ·å¼ä¼˜åŒ–
9. âœ… JSON è§£æè¾“å‡º
10. âœ… å¤šç›®æ ‡å­—æ®µ
11. âœ… ç›¸åŒå€¼å†™å…¥å¤šå­—æ®µ

### ğŸ”® æœªæ¥è€ƒè™‘
- æ‰‹åŠ¨è§¦å‘æ¨¡å¼
- é˜²æŠ–æ§åˆ¶
- è¾“å‡ºåå¤„ç†
- æ­£åˆ™æå–
- æ‰§è¡Œå†å²è®°å½•


---

## åäºŒã€éƒ¨ç½²æ­¥éª¤

### åç«¯
```bash
# 1. è¿è¡Œæ•°æ®åº“è¿ç§»
baserow migrate ai_assistant

# 2. é‡å¯åç«¯æœåŠ¡
# Ctrl+C åœæ­¢å½“å‰æœåŠ¡ï¼Œç„¶åé‡æ–°è¿è¡Œ
baserow runserver 0.0.0.0:8000

# 3. å¦‚æœæœ‰ Celeryï¼Œä¹Ÿéœ€è¦é‡å¯
```

### å‰ç«¯
```bash
# å¼€å‘æ¨¡å¼ä¸‹åº”è¯¥ä¼šè‡ªåŠ¨çƒ­é‡è½½
# å¦‚æœæ²¡æœ‰ï¼Œé‡å¯å‰ç«¯æœåŠ¡
```

### éªŒè¯
1. æ‰“å¼€è¡¨æ ¼ï¼Œç‚¹å‡»è¡¨æ ¼èœå•ä¸­çš„ã€Œé…ç½® AI åŠ©æ‰‹ã€
2. åˆ›å»ºæ–°é…ç½®ï¼Œé€‰æ‹©è§¦å‘å­—æ®µå’Œè¾“å‡ºå­—æ®µ
3. é…ç½®æç¤ºè¯æ¨¡æ¿ï¼Œä½¿ç”¨ `{å­—æ®µå}` å¼•ç”¨å­—æ®µ
4. é€‰æ‹© AI æ¨¡å‹ï¼ˆå·¥ä½œåŒºé…ç½®æˆ–è‡ªå®šä¹‰ï¼‰
5. ä¿å­˜é…ç½®
6. ç¼–è¾‘è¡¨æ ¼æ•°æ®ï¼Œè§‚å¯Ÿ AI æ˜¯å¦è‡ªåŠ¨å¤„ç†

---

## åä¸‰ã€æ–‡ä»¶å˜æ›´æ¸…å•

### åç«¯
- `models.py` - å®Œå…¨é‡å†™ï¼Œæ”¯æŒå¤šå­—æ®µè§¦å‘å’Œè¾“å‡º
- `services.py` - æ–°å¢ PromptParserã€OutputProcessorã€TriggerEvaluator
- `signals.py` - æ›´æ–°è§¦å‘é€»è¾‘
- `tasks.py` - æ›´æ–°å¼‚æ­¥å¤„ç†é€»è¾‘
- `api/views.py` - æ·»åŠ å­—æ®µåˆ—è¡¨æ¥å£
- `api/serializers.py` - æ›´æ–°åºåˆ—åŒ–å™¨
- `api/urls.py` - æ·»åŠ æ–°è·¯ç”±
- `migrations/0002_rebuild_ai_config.py` - æ•°æ®åº“è¿ç§»

### å‰ç«¯
- `AIConfigForm.vue` - å®Œå…¨é‡å†™ï¼Œæ”¯æŒæ‰€æœ‰æ–°åŠŸèƒ½
- `AIConfigItem.vue` - æ›´æ–°æ˜¾ç¤ºé€»è¾‘
- `AIConfigModal.vue` - æ›´æ–°åŠ è½½é€»è¾‘
- `services/aiConfig.js` - æ·»åŠ å­—æ®µåˆ—è¡¨ API
- `assets/css/default.css` - å®Œæ•´çš„æ ·å¼ç³»ç»Ÿ
- `locales/zh_CN.json` - å®Œæ•´çš„ä¸­æ–‡ç¿»è¯‘
- `locales/en.json` - å®Œæ•´çš„è‹±æ–‡ç¿»è¯‘
- `locales/zh_Hans.json` - ç®€ä½“ä¸­æ–‡åˆ«å
